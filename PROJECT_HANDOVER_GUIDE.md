# プロジェクト引き継ぎガイド
## 高橋萌香の卒業論文に基づくファクトチェックシステム

このドキュメントは、ファクトチェックシステムを他のAIに引き継ぐための完全なガイドです。

## 📋 プロジェクト概要

### 研究目的
- Wikidataと大規模言語モデル（LLM）を活用したファクトチェック手法の開発
- 構造化データ（Wikidata）と生成AI（OpenAI GPT）の組み合わせによる事実検証の自動化
- 動的エンティティ検索とインテリジェントな情報評価システムの実装

### 主要機能
1. **Wikidataエンティティ検索**: 動的検索とID→ラベル解決（例：Q335080 → 新海誠）
2. **OpenAI API統合**: GPT-3.5-turbo、GPT-4o-mini、GPT-4対応
3. **高度なURL評価**: 同一サイト判定、テキスト抽出、正規化
4. **使用量監視**: API使用制限、コスト管理、オーバーライド機能
5. **履歴管理**: LocalStorage活用、統計表示、エクスポート機能
6. **動的属性選択**: エンティティタイプ別の推奨属性（映画→監督、人物→職業等）

## 📁 ファイル構造

```
project/
├── index.html              # メインインターフェース（12,943文字）
├── css/
│   └── style.css           # レスポンシブスタイリング
├── js/
│   └── main.js             # コアロジック（1400+行のFactCheckSystemクラス）
├── README.md               # プロジェクト説明書
└── PROJECT_HANDOVER_GUIDE.md # このガイド（新規作成）
```

## 🔧 技術スタック

### 外部API
- **Wikidata API**: エンティティ検索、詳細取得
- **OpenAI API**: ファクトチェック実行（複数モデル対応）

### フロントエンド技術
- **HTML5**: セマンティックマークアップ
- **CSS3**: レスポンシブデザイン、モダンUI
- **JavaScript ES6+**: 非同期処理、LocalStorage管理
- **Chart.js**: データ可視化（CDN経由）
- **Font Awesome**: アイコン（CDN経由）

### データ管理
- **LocalStorage**: 履歴、設定、使用量データ
- **RESTful Table API**: 構造化データ永続化（利用可能だが現在未使用）

## 🚀 引き継ぎ手順

### ステップ1: ファイルのダウンロード
1. **Publishタブ**でプロジェクトを公開
2. 公開されたサイトから全ファイルをダウンロード
3. または、各ファイルを個別にコピー：
   - `index.html`
   - `css/style.css`
   - `js/main.js`
   - `README.md`
   - このガイドファイル

### ステップ2: 新環境への移行
1. 新しいAI環境でプロジェクトを初期化
2. ファイル構造を再現：
   ```bash
   mkdir -p css js
   # 各ファイルをアップロード/作成
   ```
3. 依存関係の確認（CDN使用のため追加インストール不要）

### ステップ3: 設定とテスト
1. OpenAI APIキーを設定
2. 基本機能テスト：
   - エンティティ検索
   - APIキー検証
   - ファクトチェック実行
3. 履歴とデータの移行（必要に応じて）

## 🔑 重要な実装詳細

### コアクラス: FactCheckSystem
```javascript
class FactCheckSystem {
    constructor() {
        // 初期化処理
    }
    
    // 主要メソッド：
    // - searchWikidataEntities() : エンティティ検索
    // - validateApiKey() : APIキー検証
    // - executeFactCheck() : ファクトチェック実行
    // - evaluateAnswers() : 回答評価
    // - manageHistory() : 履歴管理
}
```

### 重要な機能

#### 1. URL評価アルゴリズム
```javascript
extractURLsFromText(text) {
    const urlPatterns = [
        /https?:\/\/[^\s\]）)。、\n]+/gi,
        /\[https?:\/\/[^\]]+\]/gi,
        /\(https?:\/\/[^)]+\)/gi,
        /https?:\/\/[^\s、。）\]]+/gi
    ];
    // 複数パターンでURL抽出
}
```

#### 2. エンティティラベル解決
```javascript
async resolveEntityLabel(entityId) {
    // Q335080 → 新海誠 への自動変換
    // 日本語 → 英語 → ID の優先順位
}
```

#### 3. 位置情報評価
```javascript
evaluateLocation(wikidataAnswer, llmAnswer) {
    // ペナルティシステム付きスコア計算
    // baseScore + partialBonus - incorrectPenalty
}
```

## ⚠️ 注意事項

### API制限
- **OpenAI API**: 使用量とコスト監視実装済み
- **Wikidata API**: レート制限あり（通常問題なし）

### ブラウザ対応
- **LocalStorage**: モダンブラウザ必須
- **Fetch API**: ポリフィル不要（ES6+環境）
- **CORS**: 外部API呼び出しあり

### セキュリティ
- **APIキー**: クライアントサイド保存（開発環境向け）
- **入力検証**: 実装済み
- **XSS対策**: 基本的な対策実装

## 📊 既知の問題と解決済み課題

### 解決済み
✅ JavaScript初期化問題（init()メソッド呼び出し欠如）  
✅ 正規表現構文エラー（無効なスラッシュエスケープ）  
✅ APIキー検証エラー（sk-proj-, sk-org-形式対応）  
✅ URL評価の偽陰性（同一サイト異パス判定）  
✅ WikidataID表示問題（ラベル解決）  
✅ 位置評価問題（混合情報のペナルティ）  
✅ 使用制限管理（破壊的リセット→非破壊的オーバーライド）  
✅ ボタン表示切り捨て問題  
✅ バッチモード削除と単一エンティティモードへの復帰  

### 現在の制限
- サーバーサイド処理なし（静的サイト制約）
- 認証が必要なAPI統合不可
- ファイルアップロード機能なし

## 🔄 開発履歴

### 主要な変更
1. **初期実装**: 基本ファクトチェック機能
2. **URL評価強化**: 高度な正規化とテキスト抽出
3. **Wikidataラベル解決**: ID→人間可読ラベル変換
4. **使用量監視**: API制限とコスト管理
5. **バッチモード実装**: 複数エンティティ調査（後に削除）
6. **単一モード復帰**: シンプルな1エンティティ検証に特化

### 最新状態
- 単一エンティティファクトチェックシステム
- 全ての高度機能を保持
- バッチ関連コード完全削除（~500行削除）
- 安定動作確認済み

## 📝 引き継ぎ時の推奨事項

1. **README.md**を最初に確認
2. **js/main.js**のFactCheckSystemクラスを理解
3. **APIキー設定**を最初にテスト
4. **エンティティ検索**から動作確認
5. **履歴機能**でデータ永続化をテスト

## 🆘 トラブルシューティング

### よくある問題
1. **APIキーエラー**: 新形式（sk-proj-、sk-org-）対応確認
2. **CORS エラー**: ブラウザの同一オリジンポリシー制約
3. **LocalStorage制限**: ブラウザ設定確認
4. **ネットワークタイムアウト**: API応答時間の調整

### サポートリソース
- OpenAI API ドキュメント
- Wikidata API リファレンス
- Chart.js 公式ガイド
- MDN Web API リファレンス

---

**このガイドにより、他のAIが完全にプロジェクトを理解し、継続開発できるはずです。**